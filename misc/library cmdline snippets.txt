|mount %
|commit %home

=library -build-file %/sur/library/hoon
=store -build-file %/sur/graph-store/hoon
=libstore -build-file %/lib/graph-store/hoon
=libgraph -build-file %/lib/graph/hoon
=liblibrary -build-file %/lib/library/hoon

-build-file %/app/library-proxy/hoon
|start %library-proxy


:: handy state inspections
:graph-store +dbug [%state 'graphs']
:library-proxy +dbug


:: appetizers of all commands
:library-proxy &library-command [%create-library [our %library1] [%open ~]]
:library-proxy &library-command [%remove-library [our %library1]]

:library-proxy &library-command [%add-book [our %library1] ["Dune" "isbnisbnis"]]  :: isbn must be length 10 or 13
:library-proxy &library-command [%remove-book [our %library1] 123.456]


:library-proxy &library-action [%add-comment [our %library1] 123.456 "this is a comment."]
:library-proxy &library-action [%add-comment [our %library1] ~[123.456 8.319.395.793.566.789.475 789.654]]


==========================================


:: ~zod creates a library called %library1
:library-proxy &library-command [%create-library [our %library1] [%open ~]]

:: ~zod adds two books adding a book
:library-proxy &library-command [%add-book [our %library1] ["Dune" "isbnisbnis"]]
:library-proxy &library-command [%add-book [our %library1] ["ABC" "isbnisbnis123"]]

::: replace with the top level index fragment of the book titled "Dune"
=top-of-dune 170.141.184.505.067.084.173.349.631.314.681.135.104

:: ~zod adds comment on book "Dune"
:library-proxy &library-action [%add-comment [our %library1] top-of-dune "I love dune"]

:: ~nus scries for libraries available on ~zod

=libraries .^((set resource:store) %gx /=library-proxy=/libraries/noun)

:: ~nus scries for books available on ~zod/library1
=available-books  .^((set atom) %gx /=library-proxy=/books/library1/noun)


:: ~nus tries to add a book, fails because isn't in readers yet
:~zod/library-proxy &library-command [%add-book [~zod %library1] ["fake book" "isbnisbnis"]]

:: ~nus tries to add comment on book, fails cause not part of readers
:~zod/library-proxy &library-action [%add-comment [~zod %library1] top-of-dune "dune is ok"]

:: ~nus issues %request-library poke to start recieving updates %library1
:library-proxy &library-command [%request-library [~zod %library1]]

:: ~nus tries to add comment again, is successful
:~zod/library-proxy &library-action [%add-comment [~zod %library1] top-of-dune "dune is ok"]

:: ~nus adds a second comment again, is successful
:~zod/library-proxy &library-action [%add-comment [~zod %library1] top-of-dune "in my opinion"]

:: ~nus deletes own comment, succeeds
:~zod/library-proxy &library-action [%remove-comment [~zod %library1] ~[<index of comment by ~nus>]]

:: ~zod deletes nus's comment, succeeds
:library-proxy &library-action [%remove-comment [our %library1] ~[<index of comment by ~nus>]]

:: ~nus tries to delete ~zod's comment, fails
:~zod/library-proxy &library-action [%remove-comment [~zod %library1] ~[<index of comment by ~zod>]]

:: ~nus tries to delete ~zod's book, fails
:~zod/library-proxy &library-command [%remove-book [~zod %library1] top-of-dune]

:: ~nus tries to delete ~zod's library, fails
:~zod/library-proxy &library-command [%remove-library [~zod %library1]]

:: ~zod deletes book with title "Dune", succeeds. appropriate state in proxy is cleared
:library-proxy &library-command [%remove-book [our %library1] top-of-dune]

:: ~zod deletes the library, succeeds
:library-proxy &library-command [%remove-library [our %library1]]




